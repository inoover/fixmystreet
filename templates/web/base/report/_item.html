[% IF c.user.has_permission_to('planned_reports', problem.bodies_str_ids) AND c.user.is_planned_report(problem) %]
    [% item_extra_class = "item-list__item--indented" %]
    [% item_action = BLOCK %]
        <input type="submit" name="shortlist-remove" value="[% loc('Remove from shortlist') %]" title="[% loc('Remove from shortlist') %]" class="item-list__item__shortlist-remove">
    [% END %]

[% ELSIF c.user.has_permission_to('planned_reports', problem.bodies_str_ids) AND problem.shortlisted_user %]
    [% item_extra_class = "item-list__item--indented" %]
    [% item_action = BLOCK %]
        <input type="submit" name="shortlist-add" value="[% loc('Add to shortlist') %]" title="[% loc('Add to shortlist') %]" class="item-list__item__shortlist-take">
    [% END %]

[% ELSIF c.user.has_permission_to('planned_reports', problem.bodies_str_ids) %]
    [% item_extra_class = "item-list__item--indented" %]
    [% item_action = BLOCK %]
        <input type="submit" name="shortlist-add" value="[% loc('Add to shortlist') %]" title="[% loc('Add to shortlist') %]" class="item-list__item__shortlist-add">
    [% END %]
[% END %]

[% IF shortlist %]
    [% item_extra_class = "item-list__item--indented item-list__item--act-and-sort" %]
    [% item_action = BLOCK %]
        [% item_action %]
        <input type="submit" name="shortlist-up" value="[% loc('Up one') %]" title="[% loc('Up one') %]" class="item-list__item__shortlist-up" [% IF loop.first %]disabled[% END %]>
        <input type="submit" name="shortlist-down" value="[% loc('Down one') %]" title="[% loc('Down one') %]" class="item-list__item__shortlist-down" [% IF loop.last %]disabled[% END %]>
    [% END %]
[% END %]

<li class="item-list__item item-list--reports__item [% item_extra_class %]">
<a href="[% c.cobrand.base_url_for_report( problem ) %][% problem.url %]">
    [% IF problem.photo %]
        <img class="img" height="60" width="90" src="[% problem.photos.first.url_fp %]" alt="">
    [% END %]
        <h3 class="item-list__heading">[% problem.title | html %]</h3>
        <small>
            [% IF NOT no_fixed AND problem.is_fixed %]
                <span class="item-list__item__state">[% loc('Fixed') %]</span>
            [% ELSIF NOT no_fixed AND problem.is_closed %]
                <span class="item-list__item__state">[% loc('Closed') %]</span>
            [% ELSIF problem.response_priority AND (c.user.has_permission_to('report_edit_priority', problem.bodies_str_ids) OR c.user.has_permission_to('report_inspect', problem.bodies_str_ids)) %]
                <span class="item-list__item__state">[% problem.response_priority.name %]</span>
            [% END %]
            [%- IF c.cobrand.moniker != 'fixamingata' %] [%# Default: %]
                [%- prettify_dt( problem.confirmed, 1 ) %]
            [%- ELSE %] [%# Swedish cobrand fixamingata: %]
                [%- prettify_dt( problem.confirmed) %]
            [%- END %]
            [%- IF dist %], [% dist %]km[% END %]
            [%- IF problem.confirmed != problem.lastupdate AND problem.whensent != problem.lastupdate %],
                [% tprintf(loc('last updated %s'), prettify_dt( problem.lastupdate, 1 ) ) %]
            [%- END %]
            [% IF include_sentinfo %]
                [% IF c.cobrand.is_council && !c.cobrand.owns_problem( problem ) %]
                    (sent to [% problem.body %])
                [% ELSIF problem.bodies_str_ids.size > 1 %] [% loc('(sent to both)') %]
                [% ELSIF problem.bodies_str_ids.size == 0 %] [% loc('(not sent to council)') %]
                [% END %]
            [% END %]
        </small>
</a>
[% IF item_action AND page != 'around' %]
    <form method="post" action="/my/planned/change">
        <input type="hidden" name="id" value="[% problem.id %]">
        <input type="hidden" name="token" value="[% csrf_token %]">
        [% item_action %]
    </form>
[% ELSIF item_action ~%]
    [% item_action.replace('("shortlist-[^"]*)', '$1-' _ problem.id) %]
[% END ~%]
</li>
